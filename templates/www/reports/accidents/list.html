{% extends 'www/main.html' %}
{% load custom_tags_filters %}
{% block CONTENT %}

    <form role="form" method="get" class="form-inline">
        <div class="form-group">
            <label for="{{ form.started.auto_id }}">From </label>

            <div class="input-group date" id='datetimepicker1'>
                {{ form.started|addcss:"form-control input-sm" }}
                <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
            </div>
        </div>
        <div class="form-group">
            <label for="{{ form.finished.auto_id }}">to </label>

            <div class="input-group date" id='datetimepicker2'>
                {{ form.finished|addcss:"form-control input-sm" }}
                <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
            </div>
        </div>
        <label for="{{ form.tz.auto_id }}">timezone </label>

        <div class="form-group input-group">
            {{ form.tz|addcss:"form-control input-sm" }}
        </div>
        <button type="submit" class="btn btn-default btn-sm">>></button>
        <script type="text/javascript">
            $(function () {
                $('#datetimepicker1').datetimepicker({
                    format: 'DD.MM.YYYY'
                });
                $('#datetimepicker2').datetimepicker({
                    format: 'DD.MM.YYYY'
                });
            });
        </script>
    </form>

    <hr/>
    {% if error %}
        <h3 class="text-center text-danger">{{ error }}</h3>
    {% else %}
        <h3>List Properties</h3>
        <dl class="dl-horizontal">
            <dt>Started:</dt>
            <dd>{{ list_properties.started }}</dd>
            <dt>Finished:</dt>
            <dd>{{ list_properties.finished }}</dd>
            <dt>Timezone:</dt>
            <dd>{{ list_properties.timezone }}</dd>
            <dt>Total accidents:</dt>
            <dd>{{ list_properties.count }}</dd>
        </dl>
        <a href="{% url 'reports.accidents.add' %}" class="btn btn-default btn-sm"><i
                class="fa fa-plus"></i>
            New accident</a>
        <table class="table table-hover">
            <thead>
            <tr>
                <th>Date and time</th>
                <th>Company</th>
                <th>City</th>
                <th>Kind of Accident</th>
                <th>Duration</th>
                <th>Customers Affected</th>
                <th>Reason</th>
            </tr>
            </thead>
            <tbody>
            {% for accident in list %}
                <tr {% if not accident.is_completed %}class="warning"{% endif %}>
                    <td>
                        <a href="{% url 'reports.accidents.detail' pk=accident.id %}">{{ accident|accident_time_interval:list_properties.timezone }}</a>
                    </td>
                    <td>{{ accident.companies_list }}</td>
                    <td>{{ accident.cities_list }}</td>
                    <td>{{ accident.category.html_label|safe }}&nbsp;&nbsp; {{ accident.kind }}</td>
                    <td>
                        <nobr>
                            {{ accident.duration_max_str }}
                            {% if accident.is_expired %}
                                <i class="fa fa-exclamation-triangle" style="color: #d9534f;"
                                   data-toggle="tooltip"
                                   data-placement="top" title="Expired in {{ accident.overtime_str }}"
                                   rel='tooltip'></i>
                            {% endif %}
                        </nobr>
                    </td>
                    <td>
                        {{ accident.affected_customers }}
                        {% if accident.magistral_customers_affected %}
                            <span class="label label-default"
                                  title="Magistral customers affected">Magistral</span>
                        {% endif %}
                    </td>
                    <td>{{ accident.reason }}</td>
                </tr>
            {% endfor %}

            </tbody>
        </table>
    {% endif %}
{% endblock %}